name: CI

on:
  workflow_dispatch:

jobs:
#  build_base:
#    name: Build base
#    runs-on: custom-runner
#    steps:
#      - name: Checkout
#        uses: actions/checkout@v3
#
#      - name: Setup Docker Buildx
#        uses: docker/setup-buildx-action@v2
#        with:
#          version: latest
#          use: false
#
#      - name: Build
#        run: |
#          eval $(ssh-agent -s)
#          echo "${{ secrets.GITLAB_DEPLOY_KEY }}" | tr -d '\r' | ssh-add -
#          cd images/nginx && make OUTPUT=--load build
#          docker images

  build_controller:
    name: Build controller
    runs-on: custom-runner
    steps:
      - name: Checkout
        uses: actions/checkout@v3

      - name: Setup Go 1.19.0
        id: go
        uses: actions/setup-go@v3
        with:
          go-version: '1.19.0'

      - name: Setup Docker Buildx
        uses: docker/setup-buildx-action@v2
        with:
          version: latest
          use: false

      - name: Build images
        env:
          ARCH: amd64
          DOCKER_IN_DOCKER_ENABLED: false
          USER: runner
        run: |
          make build image
          docker images